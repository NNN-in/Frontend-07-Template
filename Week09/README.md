# 学习笔记

使用FSM实现html的分析

状态参考： html.spec.whatwg.org/multipage

标签分为开始标签，结束标签，自封闭标签

在标签结束状态提交标签token

属性值分为单引号 双引号 无引号

从标签构建DOM树的基本技巧是使用栈

遇到开始标签时创建元素并入栈，遇到结束标签时出栈

自封闭节点入栈后立刻出栈

任何元素的父元素都是它入栈前的栈顶

遇到style标签时保存css规则

当创建一个元素后立即计算css，理论上，当分析一个元素时，所有css规则已经收集完毕；  
在真实浏览器中，遇到写在body的style标签，需要重新CSS计算的情况暂时忽略

```javascript
let elements = stack.slice().reverse();
```
* 在computeCSS函数中，我们必须知道元素的所有父元素才能判断元素与规则是否匹配  

* 我们从上一个步骤的stack，可以获取元素的所有父元素

* 因为我们首先获取的是当前元素，所以获取和计算父元素匹配顺序是从内向外

`div div #myid`  


选择器也要从当前元素向外排列

复杂选择器拆成针对单个元素的选择器，用循环匹配父元素队列

### specificity计算

```
[0,     0,    0,      0]
inline  id    class   tagName
```

越左边权重越高